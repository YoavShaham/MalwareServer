import './App.css';
import Axios from 'axios'
import * as React from 'react';
import Box from '@mui/material/Box';
import InputLabel from '@mui/material/InputLabel';
import MenuItem from '@mui/material/MenuItem';
import FormControl from '@mui/material/FormControl';
import Select from '@mui/material/Select';
import TextField from '@mui/material/TextField';
import Button from '@mui/material/Button'



const VirusTotal = () => {
  const [requestType, setRequestType] = React.useState(''); 
  const [requestValue, setRequestValue] = React.useState(''); 
  const [result, setResult] = React.useState("");
  
    const handleSelectChange = (event) => {
      setRequestType(event.target.value);
    };

    const handleTextChange = (event) => {
      setRequestValue(event.target.value);
    };

    const ConductQuery = (event) => {
      if(requestType == 'domain'){
        SearchVirusTotalDomain()
      }else if (requestType == 'ip'){
        SearchVirusTotalIp()
      }else if (requestType == 'url'){
        SearchVirusTotalUrl()
      }else if(requestType == 'hash'){
        SearchVirusTotalHash()
      }
    }

    const SearchVirusTotalDomain = () => {
      Axios.post('http://localhost:9000/getVirusTotalDomainViaBot', {
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
      },
      params: {
        'domain': requestValue
      }
    })
    .then((resp) => {
      setResult(resp.data['result'])
    });    
  }
  
  const SearchVirusTotalIp = () => {
    Axios.post('http://localhost:9000/getVirusTotalIpViaBot', {
    headers: {
      'Content-Type': 'application/json',
      'Access-Control-Allow-Origin': '*'
    },
    params: {
      'ip': requestValue
    }
  })
  .then((resp) => {
    setResult(resp.data['result'])
  });    
}

const SearchVirusTotalHash = () => {
  Axios.post('http://localhost:9000/getVirusTotalHashViaBot', {
  headers: {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*'
  },
  params: {
    'hash': requestValue
  }
})
.then((resp) => {
  setResult(resp.data['result'])
});    
}

const SearchVirusTotalUrl = () => {
  Axios.post('http://localhost:9000/getVirusTotalUrlViaBot', {
  headers: {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*'
  },
  params: {
    'url': requestValue
  }
})
.then((resp) => {
  setResult(resp.data['result'])
});    
}

  return (
    <div className='virustotal'>
        <p>This is a virus total api service</p>
        <p>You can conduct queries based on: url, ip, domain and hash</p>
        <FormControl sx={{ m: 1, minWidth: 120 }} size="small">
        <InputLabel id="demo-select-small">Request Type</InputLabel>
        <Select
          labelId="demo-select-small"
          id="demo-select-small"
          value={requestType}
          label="Request Type"
          onChange={handleSelectChange}
        >
          <MenuItem value="">
            <em>None</em>
          </MenuItem>
          <MenuItem value={"ip"}>Ip</MenuItem>
          <MenuItem value={"domain"}>Domain</MenuItem>
          <MenuItem value={"hash"}>Hash</MenuItem>
          <MenuItem value={"url"}>Url</MenuItem>
        </Select>
      </FormControl>
      <TextField
        id="request_value_input"
        label="Request Value"
        value={requestValue}
        onChange={handleTextChange}
      />
      <Button onClick={ConductQuery}>Conduct query</Button>
      <Box component="div" sx={{ whiteSpace: 'normal' }}>
      {result}
      </Box>

    </div>
  )
}

export default VirusTotal