'use strict'

const {EventEmitter} = require('events')
const emiter = new EventEmitter()

const server = require('./app/app')
require('dotenv').config()

const repository = require('./repository/repository')
const parse_files = require('./repository/parsefiles')

process.on('uncaughtException', (err) => {
    console.error('Uncaught exception', err)
})

process.on('uncaughtRejection', (err, promise) => {
    console.error('Uncaught rejection', err)
})


let rep
console.log(process.env)
parse_files.parse_attacks(process.env.ATTACKS_FILES_DIR_PATH, process.env.DB_PATH)
.then(
repository.db_connect(process.env.DB_PATH)
.then(repo =>{
    console.log('db connected')

    rep = repo

    return server.initialize_app({port: process.env.DB_SERVICE_PORT, repo:rep})
}))


emiter.emit('boot ready')