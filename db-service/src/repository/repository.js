'use strict'

const sqlite3 = require('sqlite3').verbose();

const repository = (db) => {
    
    //site getting attacks
    const getAttacks = (keyword, colum) => {

        // selecting values from specific colum
        var query = "SELECT * FROM ATTACKS WHERE " + colum + " LIKE \"%" + keyword + "%\";"

        db.all(query, [], (err, rows) => {

            // if invalid colum
            if (err) {
                results = {'status' : '400'}
            } else {
                results = {'status' : '200',
                            'rows' : rows}
            }
            resolve(results)
        });
    }

    return Object.create({
        getAttacks
    })
}

    const db_connect = () => {
    return new Promise ((resolve, reject) => {
        let db = new sqlite3.Database('./attacks.sqlite', (err) => {

            // if filed to connect to the db
            if (err) {
                reject(new Error("failed to connect to sqlite server"))
            }
            resolve(repository(db))
        });
    })
}

module.exports = Object.assign({}, {db_connect})